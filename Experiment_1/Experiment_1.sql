USE library_db;

DROP TABLE IF EXISTS BOOK_ISSUE;
DROP TABLE IF EXISTS LIBRARY_VISITORS;
DROP TABLE IF EXISTS BOOK_S;

CREATE TABLE BOOK_S (
    BOOK_ID INT PRIMARY KEY,
    BOOK_NAME VARCHAR(20) NOT NULL,
    AUTHOR_NAME VARCHAR(20) NOT NULL,
    BOOK_COUNT INT NOT NULL CHECK (BOOK_COUNT > 0)
);

INSERT INTO BOOK_S VALUES
(101, 'HARRY POTTER', 'DAVID', 3);

SELECT * FROM BOOK_S;

CREATE TABLE LIBRARY_VISITORS (
    USER_ID INT PRIMARY KEY,
    NAME VARCHAR(20) NOT NULL,
    AGE INT NOT NULL CHECK (AGE >= 17),
    EMAIL VARCHAR(50) NOT NULL UNIQUE
);

INSERT INTO LIBRARY_VISITORS VALUES
(501, 'VANSH SHARMA', 18, 'vansh08@gmail.com'),
(502, 'VANI', 19, 'vani08@gmail.com');

SELECT * FROM LIBRARY_VISITORS;

CREATE TABLE BOOK_ISSUE (
    BOOK_ISSUE_ID INT PRIMARY KEY,
    USER_ID INT NOT NULL,
    BOOK_ID INT NOT NULL,
    ISSUE_DATE DATE,
    FOREIGN KEY (USER_ID) REFERENCES LIBRARY_VISITORS(USER_ID),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK_S(BOOK_ID)
);

INSERT INTO BOOK_ISSUE
(BOOK_ISSUE_ID, USER_ID, BOOK_ID, ISSUE_DATE)
VALUES
(1001, 501, 101, '2026-01-08');

SELECT * FROM BOOK_ISSUE;

CREATE USER IF NOT EXISTS 'LIBRARIAN'@'localhost'
IDENTIFIED BY 'ShivamDBMS3819';

SELECT CURRENT_USER();

GRANT SELECT, INSERT, UPDATE, DELETE
ON library_db.BOOK_S TO 'LIBRARIAN'@'localhost';

GRANT SELECT, INSERT, UPDATE, DELETE
ON library_db.BOOK_ISSUE TO 'LIBRARIAN'@'localhost';

GRANT SELECT, INSERT, UPDATE, DELETE
ON library_db.LIBRARY_VISITORS TO 'LIBRARIAN'@'localhost';

SELECT * FROM BOOK_S;
SELECT * FROM BOOK_ISSUE;
SELECT * FROM LIBRARY_VISITORS;

DELETE FROM BOOK_ISSUE;

SELECT * FROM BOOK_ISSUE;

REVOKE SELECT, INSERT, UPDATE, DELETE
ON library_db.BOOK_S FROM 'LIBRARIAN'@'localhost';

REVOKE SELECT, INSERT, UPDATE, DELETE
ON library_db.BOOK_ISSUE FROM 'LIBRARIAN'@'localhost';

REVOKE SELECT, INSERT, UPDATE, DELETE
ON library_db.LIBRARY_VISITORS FROM 'LIBRARIAN'@'localhost';

DROP TABLE BOOK_ISSUE;
